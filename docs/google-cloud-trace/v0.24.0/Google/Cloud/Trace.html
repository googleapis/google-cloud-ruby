---
layout: yard_main
title: "Module: Google::Cloud::Trace - Stackdriver"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/docs.css
js: 
  - /docs/js/app.js
  - /js/docs.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "Google::Cloud::Trace";
  relpath = '../../';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="../../class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span>
     &raquo; 
    <span class="title">Trace</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><h1>Module: Google::Cloud::Trace
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/google/cloud/trace.rb<span class="defines">,<br />
  lib/google/cloud/trace/span.rb,<br /> lib/google/cloud/trace/rails.rb,<br /> lib/google/cloud/trace/utils.rb,<br /> lib/google/cloud/trace/project.rb,<br /> lib/google/cloud/trace/service.rb,<br /> lib/google/cloud/trace/version.rb,<br /> lib/google/cloud/trace/label_key.rb,<br /> lib/google/cloud/trace/span_kind.rb,<br /> lib/google/cloud/trace/middleware.rb,<br /> lib/google/cloud/trace/result_set.rb,<br /> lib/google/cloud/trace/credentials.rb,<br /> lib/google/cloud/trace/time_sampler.rb,<br /> lib/google/cloud/trace/trace_record.rb,<br /> lib/google/cloud/trace/notifications.rb,<br /> lib/google/cloud/trace/v1/trace_service_client.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <h1>Stackdriver Trace</h1>

<p>The Stackdriver Trace service collects and stores latency data from your
application and displays it in the Google Cloud Platform Console, giving
you detailed near-real-time insight into application performance.</p>

<p>The Stackdriver Trace Ruby library, <code>google-cloud-trace</code>, provides:</p>

<ul>
<li>  Easy-to-use trace instrumentation that collects and collates latency
data for your Ruby application. If you just want latency trace data
for your application to appear on the Google Cloud Platform Console,
see the section on <a href="#instrumenting-your-app">instrumenting your app</a>.</li>
<li>  An idiomatic Ruby API for querying, analyzing, and manipulating trace
data in your Ruby application. For an introduction to the Trace API,
see the section on the <a href="#stackdriver-trace-api">Trace API</a>.</li>
</ul>

<h2>Instrumenting Your App</h2>

<p>This library integrates with Rack-based web frameworks such as Ruby On
Rails to provide latency trace reports for your application.
Specifcally, it:</p>

<ul>
<li>  Provides a Rack middleware that automatically reports latency traces
for http requests handled by your application, and measures the
latency of each request as a whole.</li>
<li>  Integrates with <code>ActiveSupport::Notifications</code> to add important
latency-affecting events such as ActiveRecord queries to the trace.</li>
<li>  Provides a simple API for your application code to define and
measure latency-affecting processes specific to your application.</li>
</ul>

<p>When this library is installed and configured in your running
application, you can view your application&#39;s latency traces in real time
by opening the Google Cloud Console in your web browser and navigating
to the &quot;Trace&quot; section. It also integrates with Google App Engine
Flexible and Google Container Engine to provide additional information
for applications hosted in those environments.</p>

<p>Note that not all requests will have traces. By default, the library will
sample about one trace every ten seconds per Ruby process, to prevent
heavily used applications from reporting too much data. It will also
omit certain requests used by Google App Engine for health checking. See
<span class='object_link'><a href="Trace/TimeSampler.html" title="Google::Cloud::Trace::TimeSampler (class)">TimeSampler</a></span> for more details.</p>

<h3>Using instrumentation with Ruby on Rails</h3>

<p>To install application instrumentation in your Ruby on Rails app, add
this gem, <code>google-cloud-trace</code>, to your Gemfile and update your bundle.
Then add the following line to your <code>config/application.rb</code> file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace/rails</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>This will install a Railtie that automatically integrates with the
Rails framework, installing the middleware and the ActiveSupport
integration for you. Your application traces, including basic request
tracing, ActiveRecord query measurements, and view render measurements,
should then start appearing in the Cloud Console.</p>

<p>See the <span class='object_link'><a href="Trace/Railtie.html" title="Google::Cloud::Trace::Railtie (class)">Railtie</a></span> class for more information,
including how to customize your application traces.</p>

<h3>Using instrumentation with Sinatra</h3>

<p>To install application instrumentation in your Sinatra app, add this gem,
<code>google-cloud-trace</code>, to your Gemfile and update your bundle. Then add
the following lines to your main application Ruby file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_use'>use</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Trace</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/Middleware.html" title="Google::Cloud::Trace::Middleware (class)">Middleware</a></span></span>
</code></pre>

<p>This will install the trace middleware in your application, providing
basic request tracing for your application. You may measure additional
processes such as database queries or calls to external services using
other classes in this library. See the <span class='object_link'><a href="Trace/Middleware.html" title="Google::Cloud::Trace::Middleware (class)">Middleware</a></span>
documentation for more information.</p>

<h3>Using instrumentation with other Rack-based frameworks</h3>

<p>To install application instrumentation in an app using another Rack-based
web framework, add this gem, <code>google-cloud-trace</code>, to your Gemfile and
update your bundle. Then add install the trace middleware in your
middleware stack. In most cases, this means adding these lines to your
<code>config.ru</code> Rack configuration file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_use'>use</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Trace</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/Middleware.html" title="Google::Cloud::Trace::Middleware (class)">Middleware</a></span></span>
</code></pre>

<p>Some web frameworks have an alternate mechanism for modifying the
middleware stack. Consult your web framework&#39;s documentation for more
information.</p>

<h3>The Stackdriver diagnostics suite</h3>

<p>The trace library is part of the Stackdriver diagnostics suite, which
also includes error reporting and log analysis. If you include the
<code>stackdriver</code> gem in your Gemfile, this trace library will be included
automatically. In addition, if you include the <code>stackdriver</code> gem in an
application using Ruby On Rails, the Railtie will be installed
automatically; you will not need to write any code to view latency
traces for your appl. See the documentation for the &quot;stackdriver&quot; gem
for more details.</p>

<h2>Stackdriver Trace API</h2>

<p>This library also includes an easy to use Ruby client for the
Stackdriver Trace API. This API provides calls to report and modify
application traces, as well as to query and analyze existing traces.</p>

<p>For further information on the trace API, see
<span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Project</a></span>.</p>

<h3>Querying traces using the API</h3>

<p>Using the Stackdriver Trace API, your application can query and analyze
its own traces and traces of other projects. Here is an example query
for all traces in the past hour.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Trace</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>

<span class='id identifier rubyid_traces'>traces</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_list_traces'>list_traces</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='int'>3600</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
<span class='id identifier rubyid_traces'>traces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_trace'>trace</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Retrieved trace ID: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_trace_id'>trace_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Each trace is an object of type <span class='object_link'><a href="Trace/TraceRecord.html" title="Google::Cloud::Trace::TraceRecord (class)">TraceRecord</a></span>,
which provides methods for analyzing tasks that took place during the
request trace. See <a href="https://cloud.google.com/trace">https://cloud.google.com/trace</a> for more information
on the kind of data you can capture in a trace.</p>

<h3>Reporting traces using the API</h3>

<p>Usually it is easiest to use this library&#39;s trace instrumentation
features to collect and record application trace information. However,
you may also use the trace API to update this data. Here is an example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Trace</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>

<span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Trace</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>
<span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>root_span</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='comment'># Do stuff...
</span><span class='kw'>end</span>

<span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_patch_traces'>patch_traces</span> <span class='id identifier rubyid_trace'>trace</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Trace/LabelKey.html" title="Google::Cloud::Trace::LabelKey (module)">LabelKey</a></span>, <span class='object_link'><a href="Trace/Notifications.html" title="Google::Cloud::Trace::Notifications (module)">Notifications</a></span>, <span class='object_link'><a href="Trace/V1.html" title="Google::Cloud::Trace::V1 (module)">V1</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Trace/Middleware.html" title="Google::Cloud::Trace::Middleware (class)">Middleware</a></span>, <span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Project</a></span>, <span class='object_link'><a href="Trace/Railtie.html" title="Google::Cloud::Trace::Railtie (class)">Railtie</a></span>, <span class='object_link'><a href="Trace/ResultSet.html" title="Google::Cloud::Trace::ResultSet (class)">ResultSet</a></span>, <span class='object_link'><a href="Trace/Span.html" title="Google::Cloud::Trace::Span (class)">Span</a></span>, <span class='object_link'><a href="Trace/SpanKind.html" title="Google::Cloud::Trace::SpanKind (class)">SpanKind</a></span>, <span class='object_link'><a href="Trace/TimeSampler.html" title="Google::Cloud::Trace::TimeSampler (class)">TimeSampler</a></span>, <span class='object_link'><a href="Trace/TraceRecord.html" title="Google::Cloud::Trace::TraceRecord (class)">TraceRecord</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="THREAD_KEY-constant" class="">THREAD_KEY =
          
        </dt>
        <dd><pre class="code"><span class='symbol'>:__stackdriver_trace_span__</span></pre></dd>
      
        <dt id="VERSION-constant" class="">VERSION =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.24.0</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get-class_method" title="get (class method)">.<strong>get</strong>  &#x21d2; Google::Cloud::Trace::TraceSpan, ... </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Retrieve the current trace span or trace object for the current thread.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_span-class_method" title="in_span (class method)">.<strong>in_span</strong>(name, kind: Google::Cloud::Trace::SpanKind::UNSPECIFIED, labels: {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Open a new span for the current thread, instrumenting the given block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(project: nil, keyfile: nil, scope: nil, timeout: nil, client_config: nil)  &#x21d2; Google::Cloud::Trace::Project </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a new object for connecting to the Stackdriver Trace service.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set-class_method" title="set (class method)">.<strong>set</strong>(trace)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set the current trace span being measured for the current thread, or the current trace if no span is currently open.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="get-class_method">
  
    .<strong>get</strong>  &#x21d2; <tt>Google::Cloud::Trace::TraceSpan</tt>, ... 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Retrieve the current trace span or trace object for the current thread.
This data should previously have been set using
<span class='object_link'><a href="#set-class_method" title="Google::Cloud::Trace.set (method)">set</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>
<span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_new_trace'>new_trace</span>
<span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'><span class='object_link'><a href="#set-class_method" title="Google::Cloud::Trace.set (method)">set</a></span></span> <span class='id identifier rubyid_trace'>trace</span>

<span class='comment'># Later...
</span><span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_create_span'><span class='object_link'><a href="Trace/TraceRecord.html#create_span-instance_method" title="Google::Cloud::Trace::TraceRecord#create_span (method)">create_span</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_span</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Google::Cloud::Trace::TraceSpan</tt>, <tt><span class='object_link'><a href="Trace/TraceRecord.html" title="Google::Cloud::Trace::TraceRecord (class)">Google::Cloud::Trace::TraceRecord</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The span or trace object,
or <code>nil</code>.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 287</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#THREAD_KEY-constant" title="Google::Cloud::Trace::THREAD_KEY (constant)">THREAD_KEY</a></span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="in_span-class_method">
  
    .<strong>in_span</strong>(name, kind: Google::Cloud::Trace::SpanKind::UNSPECIFIED, labels: {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Open a new span for the current thread, instrumenting the given block.
The span is created within the current thread&#39;s trace context as set by
<span class='object_link'><a href="#set-class_method" title="Google::Cloud::Trace.set (method)">set</a></span>. The context is updated so any further calls
within the block will create subspans. The new span is also yielded to
the block.</p>

<p>Does nothing if there is no trace context for the current thread.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>
<span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_new_trace'>new_trace</span>
<span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'><span class='object_link'><a href="#set-class_method" title="Google::Cloud::Trace.set (method)">set</a></span></span> <span class='id identifier rubyid_trace'>trace</span>

<span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_span</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_span'>span</span><span class='op'>|</span>
  <span class='id identifier rubyid_span'>span</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'># Do stuff...
</span>
  <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_subspan</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_subspan'>subspan</span><span class='op'>|</span>
    <span class='id identifier rubyid_subspan'>subspan</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sub-bar</span><span class='tstring_end'>&quot;</span></span>
    <span class='comment'># Do other stuff...
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Name of the span to create</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>kind</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/SpanKind.html" title="Google::Cloud::Trace::SpanKind (class)">Google::Cloud::Trace::SpanKind</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Kind of span to create.
Optional.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>labels</span>
      
      
        <span class='type'>(<tt>Hash{String =&gt; String}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Labels for the span</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 322</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/SpanKind.html" title="Google::Cloud::Trace::SpanKind (class)">SpanKind</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/SpanKind.html#UNSPECIFIED-constant" title="Google::Cloud::Trace::SpanKind::UNSPECIFIED (constant)">UNSPECIFIED</a></span></span><span class='comma'>,</span>
                 <span class='label'>labels:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='id identifier rubyid_get'>get</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_parent'>parent</span>
    <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span> <span class='label'>labels:</span> <span class='id identifier rubyid_labels'>labels</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
      <span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_child'>child</span>
      <span class='kw'>begin</span>
        <span class='kw'>yield</span> <span class='id identifier rubyid_child'>child</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_parent'>parent</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>yield</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-class_method">
  
    .<strong>new</strong>(project: nil, keyfile: nil, scope: nil, timeout: nil, client_config: nil)  &#x21d2; <tt><span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Google::Cloud::Trace::Project</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a new object for connecting to the Stackdriver Trace service.
Each call creates a new connection.</p>

<p>For more information on connecting to Google Cloud see the
<a href="https://googlecloudplatform.github.io/google-cloud-ruby/#/docs/guides/authentication">Authentication
Guide</a>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

<span class='id identifier rubyid_traces'>traces</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_list_traces'>list_traces</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='int'>3600</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
<span class='id identifier rubyid_traces'>traces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_trace'>trace</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Retrieved trace ID: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_trace_id'>trace_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>project</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Project identifier for the Stackdriver Trace
service.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>keyfile</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Keyfile downloaded from Google Cloud:
either the JSON data or the path to a readable file.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>scope</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The OAuth 2.0 scopes controlling
the set of resources and operations that the connection can access.
See <a href="https://developers.google.com/identity/protocols/OAuth2">Using OAuth 2.0 to Access Google
APIs</a>.
The default scope is <code>https://www.googleapis.com/auth/cloud-platform</code></p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Default timeout to use in requests. Optional.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Google::Cloud::Trace::Project</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227
228
229
230
231
232
233
234
235
236
237
238
239</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 225</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='label'>project:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>keyfile:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>scope:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='kw'>nil</span><span class='comma'>,</span>
             <span class='label'>client_config:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_project'>project</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Project</a></span></span><span class='period'>.</span><span class='id identifier rubyid_default_project'>default_project</span>
  <span class='id identifier rubyid_project'>project</span> <span class='op'>=</span> <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='comment'># Always cast to a string
</span>  <span class='id identifier rubyid_fail'>fail</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>project is missing</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_credentials'>credentials</span> <span class='op'>=</span>
    <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'>Credentials</span><span class='period'>.</span><span class='id identifier rubyid_credentials_with_scope'>credentials_with_scope</span> <span class='id identifier rubyid_keyfile'>keyfile</span><span class='comma'>,</span>
                                                             <span class='id identifier rubyid_scope'>scope</span>

  <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Project</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'>Service</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='id identifier rubyid_project'>project</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span>
                            <span class='label'>client_config:</span> <span class='id identifier rubyid_client_config'>client_config</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set-class_method">
  
    .<strong>set</strong>(trace)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set the current trace span being measured for the current thread, or
the current trace if no span is currently open. This may be used with
web frameworks that assign a thread to each request, to track the
trace instrumentation state for the request being handled. You may use
<span class='object_link'><a href="#get-class_method" title="Google::Cloud::Trace.get (method)">get</a></span> to retrieve the data.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>
<span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_new_trace'>new_trace</span>
<span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_trace'>trace</span>

<span class='comment'># Later...
</span><span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="#get-class_method" title="Google::Cloud::Trace.get (method)">get</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create_span'><span class='object_link'><a href="Trace/TraceRecord.html#create_span-instance_method" title="Google::Cloud::Trace::TraceRecord#create_span (method)">create_span</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_span</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>trace</span>
      
      
        <span class='type'>(<tt>Google::Cloud::Trace::TraceSpan</tt>, <tt><span class='object_link'><a href="Trace/TraceRecord.html" title="Google::Cloud::Trace::TraceRecord (class)">Google::Cloud::Trace::TraceRecord</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The current span
being measured, the current trace object, or <code>nil</code> if none.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


262
263
264
265
266</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 262</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_trace'>trace</span>
  <span class='id identifier rubyid_trace_context'>trace_context</span> <span class='op'>=</span> <span class='id identifier rubyid_trace'>trace</span> <span class='op'>?</span> <span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_trace_context'>trace_context</span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='const'>Stackdriver</span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>TraceContext</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_trace_context'>trace_context</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#THREAD_KEY-constant" title="Google::Cloud::Trace::THREAD_KEY (constant)">THREAD_KEY</a></span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_trace'>trace</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
