---
layout: yard_main
title: "File: AUTHENTICATION - Google"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "AUTHENTICATION";
  relpath = '';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="file_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: AUTHENTICATION</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><div id='filecontents'><h1>Authentication</h1>

<p>In general, the google-cloud-spanner library uses <a href="https://cloud.google.com/iam/docs/creating-managing-service-accounts">Service
Account</a>
credentials to connect to Google Cloud services. When running on Compute Engine
the credentials will be discovered automatically. When running on other
environments, the Service Account credentials can be specified by providing the
path to the <a href="https://cloud.google.com/iam/docs/managing-service-account-keys">JSON
keyfile</a> for
the account (or the JSON itself) in environment variables. Additionally, Cloud
SDK credentials can also be discovered automatically, but this is only
recommended during development.</p>

<h2>Project and Credential Lookup</h2>

<p>The google-cloud-spanner library aims to make authentication as simple as
possible, and provides several mechanisms to configure your system without
providing <strong>Project ID</strong> and <strong>Service Account Credentials</strong> directly in code.</p>

<p><strong>Project ID</strong> is discovered in the following order:</p>

<ol>
<li>Specify project ID in method arguments</li>
<li>Specify project ID in configuration</li>
<li>Discover project ID in environment variables</li>
<li>Discover GCE project ID</li>
</ol>

<p><strong>Credentials</strong> are discovered in the following order:</p>

<ol>
<li>Specify credentials in method arguments</li>
<li>Specify credentials in configuration</li>
<li>Discover credentials path in environment variables</li>
<li>Discover credentials JSON in environment variables</li>
<li>Discover credentials file in the Cloud SDK&#39;s path</li>
<li>Discover GCE credentials</li>
</ol>

<h3>Google Cloud Platform environments</h3>

<p>While running on Google Cloud Platform environments such as Google Compute
Engine, Google App Engine and Google Kubernetes Engine, no extra work is needed.
The <strong>Project ID</strong> and <strong>Credentials</strong> and are discovered automatically. Code
should be written as if already authenticated. Just be sure when you <a href="https://cloud.google.com/compute/docs/authentication#using">set up the
GCE instance</a>, you add the correct scopes for the APIs you want to
access. For example:</p>

<ul>
<li><strong>All APIs</strong>

<ul>
<li><code>https://www.googleapis.com/auth/cloud-platform</code></li>
<li><code>https://www.googleapis.com/auth/cloud-platform.read-only</code></li>
</ul></li>
<li><strong>BigQuery</strong>

<ul>
<li><code>https://www.googleapis.com/auth/bigquery</code></li>
<li><code>https://www.googleapis.com/auth/bigquery.insertdata</code></li>
</ul></li>
<li><strong>Compute Engine</strong>

<ul>
<li><code>https://www.googleapis.com/auth/compute</code></li>
</ul></li>
<li><strong>Datastore</strong>

<ul>
<li><code>https://www.googleapis.com/auth/datastore</code></li>
<li><code>https://www.googleapis.com/auth/userinfo.email</code></li>
</ul></li>
<li><strong>DNS</strong>

<ul>
<li><code>https://www.googleapis.com/auth/ndev.clouddns.readwrite</code></li>
</ul></li>
<li><strong>Pub/Sub</strong>

<ul>
<li><code>https://www.googleapis.com/auth/pubsub</code></li>
</ul></li>
<li><strong>Storage</strong>

<ul>
<li><code>https://www.googleapis.com/auth/devstorage.full_control</code></li>
<li><code>https://www.googleapis.com/auth/devstorage.read_only</code></li>
<li><code>https://www.googleapis.com/auth/devstorage.read_write</code></li>
</ul></li>
</ul>

<h3>Environment Variables</h3>

<p>The <strong>Project ID</strong> and <strong>Credentials JSON</strong> can be placed in environment
variables instead of declaring them directly in code. Each service has its own
environment variable, allowing for different service accounts to be used for
different services. (See the READMEs for the individual service gems for
details.) The path to the <strong>Credentials JSON</strong> file can be stored in the
environment variable, or the <strong>Credentials JSON</strong> itself can be stored for
environments such as Docker containers where writing files is difficult or not
encouraged.</p>

<p>The environment variables that Spanner checks for project ID are:</p>

<ol>
<li><code>SPANNER_PROJECT</code></li>
<li><code>GOOGLE_CLOUD_PROJECT</code></li>
</ol>

<p>The environment variables that Spanner checks for credentials are configured on <span class='object_link'><a href="Google/Cloud/Spanner/V1/Credentials.html" title="Google::Cloud::Spanner::V1::Credentials (class)">Google::Cloud::Spanner::V1::Credentials</a></span>:</p>

<ol>
<li><code>SPANNER_CREDENTIALS</code> - Path to JSON file, or JSON contents</li>
<li><code>SPANNER_KEYFILE</code> - Path to JSON file, or JSON contents</li>
<li><code>GOOGLE_CLOUD_CREDENTIALS</code> - Path to JSON file, or JSON contents</li>
<li><code>GOOGLE_CLOUD_KEYFILE</code> - Path to JSON file, or JSON contents</li>
<li><code>GOOGLE_APPLICATION_CREDENTIALS</code> - Path to JSON file</li>
</ol>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPANNER_PROJECT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>     <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-project-id</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPANNER_CREDENTIALS</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/keyfile.json</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Google/Cloud/Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
</code></pre>

<h3>Configuration</h3>

<p>The <strong>Project ID</strong> and <strong>Credentials JSON</strong> can be configured instead of placing them in environment variables or providing them as arguments.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='const'><span class='object_link'><a href="Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="Google/Cloud/Spanner.html#configure-class_method" title="Google::Cloud::Spanner.configure (method)">configure</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-project-id</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_credentials'>credentials</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/keyfile.json</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Google/Cloud/Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
</code></pre>

<h3>Cloud SDK</h3>

<p>This option allows for an easy way to authenticate during development. If
credentials are not provided in code or in environment variables, then Cloud SDK
credentials are discovered.</p>

<p>To configure your system for this, simply:</p>

<ol>
<li><a href="https://cloud.google.com/sdk">Download and install the Cloud SDK</a></li>
<li>Authenticate using OAuth 2.0 <code>$ gcloud auth login</code></li>
<li>Write code as if already authenticated.</li>
</ol>

<p><strong>NOTE:</strong> This is <em>not</em> recommended for running in production. The Cloud SDK
<em>should</em> only be used during development.</p>

<h2>Creating a Service Account</h2>

<p>Google Cloud requires a <strong>Project ID</strong> and <strong>Service Account Credentials</strong> to
connect to the APIs. You will use the <strong>Project ID</strong> and <strong>JSON key file</strong> to
connect to most services with google-cloud-spanner.</p>

<p>If you are not running this client on Google Compute Engine, you need a Google
Developers service account.</p>

<ol>
<li>Visit the <a href="https://console.cloud.google.com/project">Google Developers Console</a>.</li>
<li>Create a new project or click on an existing project.</li>
<li>Activate the slide-out navigation tray and select <strong>API Manager</strong>. From
here, you will enable the APIs that your application requires.</li>
</ol>

<p><img src="https://raw.githubusercontent.com/GoogleCloudPlatform/gcloud-common/master/authentication/enable-apis.png" alt="Enable the APIs that your application requires"></p>

<p><em>Note: You may need to enable billing in order to use these services.</em></p>

<ol>
<li>Select <strong>Credentials</strong> from the side navigation.</li>
</ol>

<p>You should see a screen like one of the following.</p>

<p><img src="https://raw.githubusercontent.com/GoogleCloudPlatform/gcloud-common/master/authentication/create-new-service-account.png" alt="Create a new service account"></p>

<p><img src="https://raw.githubusercontent.com/GoogleCloudPlatform/gcloud-common/master/authentication/create-new-service-account-existing-keys.png" alt="Create a new service account With Existing Keys"></p>

<p>Find the &quot;Add credentials&quot; drop down and select &quot;Service account&quot; to be
   guided through downloading a new JSON key file.</p>

<p>If you want to re-use an existing service account, you can easily generate a
   new key file. Just select the account you wish to re-use, and click &quot;Generate
   new JSON key&quot;:</p>

<p><img src="https://raw.githubusercontent.com/GoogleCloudPlatform/gcloud-common/master/authentication/reuse-service-account.png" alt="Re-use an existing service account"></p>

<p>The key file you download will be used by this library to authenticate API
   requests and should be stored in a secure location.</p>

<h2>Troubleshooting</h2>

<p>If you&#39;re having trouble authenticating you can ask for help by following the
<a href="file.TROUBLESHOOTING.html" title="Troubleshooting Guide">Troubleshooting Guide</a>.</p>
</div></div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
