---
layout: yard_main
title: "Class: Google::Cloud::Spanner::BatchSnapshot - Google"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "Google::Cloud::Spanner::BatchSnapshot";
  relpath = '../../../';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="../../../class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="../../../_index.html">Index (B)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span>
     &raquo; 
    <span class="title">BatchSnapshot</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><h1>Class: Google::Cloud::Spanner::BatchSnapshot
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Google::Cloud::Spanner::BatchSnapshot</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/google/cloud/spanner/batch_snapshot.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <h1>BatchSnapshot</h1>

<p>Represents a read-only transaction that can be configured to read at
timestamps in the past and allows for exporting arbitrarily large
amounts of data from Cloud Spanner databases. This is a snapshot which
additionally allows to partition a read or query request. The read/query
request can then be executed independently over each partition while
observing the same snapshot of the database. A BatchSnapshot can also be
shared across multiple processes/machines by passing around its
serialized value and then recreating the transaction using
BatchClient#dump.</p>

<p>Unlike locking read-write transactions, BatchSnapshot will never abort.
They can fail if the chosen read timestamp is garbage collected; however
any read or query activity within an hour on the transaction avoids
garbage collection and most applications do not need to worry about this
in practice.</p>

<p>See <span class='object_link'><a href="BatchClient.html#batch_snapshot-instance_method" title="Google::Cloud::Spanner::BatchClient#batch_snapshot (method)">Google::Cloud::Spanner::BatchClient#batch_snapshot</a></span> and <span class='object_link'><a href="BatchClient.html#load_batch_snapshot-instance_method" title="Google::Cloud::Spanner::BatchClient#load_batch_snapshot (method)">Google::Cloud::Spanner::BatchClient#load_batch_snapshot</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_partitions'>partitions</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_partition_read'>partition_read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_partition'>partition</span> <span class='op'>=</span> <span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute_partition'>execute_partition</span> <span class='id identifier rubyid_partition'>partition</span>

<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span></code></pre>
    
  </div>


</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Closes the batch snapshot and releases the underlying resources.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dump-instance_method" title="#dump (instance method)">#<strong>dump</strong>  &#x21d2; String </a>
    

    
      (also: #serialize)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Serializes the batch snapshot object so it can be recreated on another process.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">#<strong>execute</strong>(sql, params: nil, types: nil)  &#x21d2; Google::Cloud::Spanner::Results </a>
    

    
      (also: #query)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Executes a SQL query.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_partition-instance_method" title="#execute_partition (instance method)">#<strong>execute_partition</strong>(partition)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Execute the partition to return a ResultSet.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#partition_query-instance_method" title="#partition_query (instance method)">#<strong>partition_query</strong>(sql, params: nil, types: nil, partition_size_bytes: nil, max_partitions: nil)  &#x21d2; Array&lt;Google::Cloud::Spanner::Partition&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a list of <span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Partition</a></span> objects to execute a batch query against a database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#partition_read-instance_method" title="#partition_read (instance method)">#<strong>partition_read</strong>(table, columns, keys: nil, index: nil, partition_size_bytes: nil, max_partitions: nil)  &#x21d2; Array&lt;Google::Cloud::Spanner::Partition&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a list of <span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Partition</a></span> objects to read zero or more rows from a database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read-instance_method" title="#read (instance method)">#<strong>read</strong>(table, columns, keys: nil, index: nil, limit: nil)  &#x21d2; Google::Cloud::Spanner::Results </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Read rows from a database table, as a simple alternative to <span class='object_link'><a href="#execute-instance_method" title="Google::Cloud::Spanner::BatchSnapshot#execute (method)">#execute</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#timestamp-instance_method" title="#timestamp (instance method)">#<strong>timestamp</strong>  &#x21d2; Time </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The read timestamp chosen for batch snapshot.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#transaction_id-instance_method" title="#transaction_id (instance method)">#<strong>transaction_id</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Identifier of the batch snapshot transaction.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="close-instance_method">
  
    #<strong>close</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Closes the batch snapshot and releases the underlying resources.</p>

<p>This should only be called once the batch snapshot is no longer needed
anywhere. In particular if this batch snapshot is being used across
multiple machines, calling this method on any of the machines will
render the batch snapshot invalid everywhere.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_partitions'>partitions</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_partition_read'>partition_read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_partition'>partition</span> <span class='op'>=</span> <span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute_partition'>execute_partition</span> <span class='id identifier rubyid_partition'>partition</span>

<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


355
356
357
358
359</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 355</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_ensure_session!'>ensure_session!</span>

  <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_release!'>release!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dump-instance_method">
  
    #<strong>dump</strong>  &#x21d2; <tt>String</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='serialize-instance_method'>serialize</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Serializes the batch snapshot object so it can be recreated on another
process. See <span class='object_link'><a href="BatchClient.html#load_batch_snapshot-instance_method" title="Google::Cloud::Spanner::BatchClient#load_batch_snapshot (method)">Google::Cloud::Spanner::BatchClient#load_batch_snapshot</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_partitions'>partitions</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_partition_read'>partition_read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_partition'>partition</span> <span class='op'>=</span> <span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

<span class='id identifier rubyid_serialized_snapshot'>serialized_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>
<span class='id identifier rubyid_serialized_partition'>serialized_partition</span> <span class='op'>=</span> <span class='id identifier rubyid_partition'>partition</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>

<span class='comment'># In a separate process
</span><span class='id identifier rubyid_new_batch_snapshot'>new_batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_load_batch_snapshot'>load_batch_snapshot</span> \
  <span class='id identifier rubyid_serialized_snapshot'>serialized_snapshot</span>

<span class='id identifier rubyid_new_partition'>new_partition</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_load_partition'>load_partition</span> \
  <span class='id identifier rubyid_serialized_partition'>serialized_partition</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_new_batch_snapshot'>new_batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute_partition'>execute_partition</span> \
  <span class='id identifier rubyid_new_partition'>new_partition</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The serialized representation of the batch snapshot.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


614
615
616</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 614</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dump'>dump</span>
  <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span> <span class='id identifier rubyid_to_h'>to_h</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute-instance_method">
  
    #<strong>execute</strong>(sql, params: nil, types: nil)  &#x21d2; <tt><span class='object_link'><a href="Results.html" title="Google::Cloud::Spanner::Results (class)">Google::Cloud::Spanner::Results</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='query-instance_method'>query</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Executes a SQL query.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Query using query parameters:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WHERE active = @active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                 <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Query with a SQL STRUCT query parameter as a Hash:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_user_hash'>user_hash</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID = @user_struct.id </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND name = @user_struct.name </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND active = @user_struct.active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                 <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>user_struct:</span> <span class='id identifier rubyid_user_hash'>user_hash</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Specify the SQL STRUCT type using Fields object:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_user_type'>user_type</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span><span class='lparen'>(</span>
  <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='symbol'>:INT64</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='symbol'>:STRING</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='symbol'>:BOOL</span> <span class='rbrace'>}</span>
<span class='rparen'>)</span>
<span class='id identifier rubyid_user_hash'>user_hash</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID = @user_struct.id </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND name = @user_struct.name </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND active = @user_struct.active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                 <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>user_struct:</span> <span class='id identifier rubyid_user_hash'>user_hash</span> <span class='rbrace'>}</span><span class='comma'>,</span>
                                 <span class='label'>types:</span> <span class='lbrace'>{</span> <span class='label'>user_struct:</span> <span class='id identifier rubyid_user_type'>user_type</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Or, query with a SQL STRUCT as a typed Data object:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_user_type'>user_type</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span><span class='lparen'>(</span>
  <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='symbol'>:INT64</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='symbol'>:STRING</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='symbol'>:BOOL</span> <span class='rbrace'>}</span>
<span class='rparen'>)</span>
<span class='id identifier rubyid_user_data'>user_data</span> <span class='op'>=</span> <span class='id identifier rubyid_user_type'>user_type</span><span class='period'>.</span><span class='id identifier rubyid_struct'>struct</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID = @user_struct.id </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND name = @user_struct.name </span><span class='tstring_end'>&quot;</span></span> \
                                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND active = @user_struct.active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                 <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>user_struct:</span> <span class='id identifier rubyid_user_data'>user_data</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sql</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The SQL query string. See <a href="https://cloud.google.com/spanner/docs/query-syntax">Query
syntax</a>.</p>

<p>The SQL query string can contain parameter placeholders. A parameter
placeholder consists of &quot;@&quot; followed by the parameter name.
Parameter names consist of any combination of letters, numbers, and
underscores.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>SQL parameters for the query string. The
parameter placeholders, minus the &quot;@&quot;, are the the hash keys, and
the literal values are the hash values. If the query string contains
something like &quot;WHERE id &gt; @msg_id&quot;, then the params must contain
something like <code>:msg_id =&gt; 1</code>.</p>

<p>Ruby types are mapped to Spanner types as follows:</p>

<table><thead>
<tr>
<th>Spanner</th>
<th>Ruby</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><code>BOOL</code></td>
<td><code>true</code>/<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>INT64</code></td>
<td><code>Integer</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT64</code></td>
<td><code>Float</code></td>
<td></td>
</tr>
<tr>
<td><code>STRING</code></td>
<td><code>String</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>Date</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>Time</code>, <code>DateTime</code></td>
<td></td>
</tr>
<tr>
<td><code>BYTES</code></td>
<td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>
<td></td>
</tr>
<tr>
<td><code>ARRAY</code></td>
<td><code>Array</code></td>
<td>Nested arrays are not supported.</td>
</tr>
<tr>
<td><code>STRUCT</code></td>
<td><code>Hash</code>, <span class='object_link'><a href="Data.html" title="Google::Cloud::Spanner::Data (class)">Data</a></span></td>
<td></td>
</tr>
</tbody></table>

<p>See <a href="https://cloud.google.com/spanner/docs/data-definition-language#data_types">Data
types</a>.</p>

<p>See <a href="https://cloud.google.com/spanner/docs/data-types#constructing-a-struct">Data Types - Constructing a
STRUCT</a>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>types</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Types of the SQL parameters in <code>params</code>. It is not
always possible for Cloud Spanner to infer the right SQL type from a
value in <code>params</code>. In these cases, the <code>types</code> hash must be used to
specify the SQL type for these values.</p>

<p>The keys of the hash should be query string parameter placeholders,
minus the &quot;@&quot;. The values of the hash should be Cloud Spanner type
codes from the following list:</p>

<ul>
<li><code>:BOOL</code></li>
<li><code>:BYTES</code></li>
<li><code>:DATE</code></li>
<li><code>:FLOAT64</code></li>
<li><code>:INT64</code></li>
<li><code>:STRING</code></li>
<li><code>:TIMESTAMP</code></li>
<li><code>Array</code> - Lists are specified by providing the type code in an
array. For example, an array of integers are specified as
<code>[:INT64]</code>.</li>
<li><span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span> - Types for STRUCT values (<code>Hash</code>/<span class='object_link'><a href="Data.html" title="Google::Cloud::Spanner::Data (class)">Data</a></span> objects) are
specified using a <span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span> object.</li>
</ul>

<p>Types are optional.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Results.html" title="Google::Cloud::Spanner::Results (class)">Google::Cloud::Spanner::Results</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The results of the query
execution.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


514
515
516
517
518
519
520
521</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 514</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span> <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='label'>params:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>types:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_ensure_session!'>ensure_session!</span>

  <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span> <span class='op'>=</span> <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_to_input_params_and_types'>to_input_params_and_types</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span>

  <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='label'>params:</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='label'>types:</span> <span class='id identifier rubyid_types'>types</span><span class='comma'>,</span>
                       <span class='label'>transaction:</span> <span class='id identifier rubyid_tx_selector'>tx_selector</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_partition-instance_method">
  
    #<strong>execute_partition</strong>(partition)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Execute the partition to return a ResultSet. The result returned
could be zero or more rows. The row metadata may be absent if no rows
are returned.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_partitions'>partitions</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_partition_read'>partition_read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_partition'>partition</span> <span class='op'>=</span> <span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute_partition'>execute_partition</span> <span class='id identifier rubyid_partition'>partition</span>

<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>partition</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Google::Cloud::Spanner::Partition</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The partition to
be executed.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


316
317
318
319
320
321
322
323
324
325
326
327
328
329
330</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 316</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_partition'>execute_partition</span> <span class='id identifier rubyid_partition'>partition</span>
  <span class='id identifier rubyid_ensure_session!'>ensure_session!</span>

  <span class='id identifier rubyid_partition'>partition</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Partition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_load'><span class='object_link'><a href="Partition.html#load-class_method" title="Google::Cloud::Spanner::Partition.load (method)">load</a></span></span> <span class='id identifier rubyid_partition'>partition</span> <span class='kw'>unless</span> <span class='id identifier rubyid_partition'>partition</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Partition</a></span></span>
  <span class='comment'># TODO: raise if partition.empty?
</span>
  <span class='comment'># TODO: raise if session.path != partition.session
</span>  <span class='comment'># TODO: raise if grpc.transaction != partition.transaction
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_partition'>partition</span><span class='period'>.</span><span class='id identifier rubyid_execute?'>execute?</span>
    <span class='id identifier rubyid_execute_partition_query'>execute_partition_query</span> <span class='id identifier rubyid_partition'>partition</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_partition'>partition</span><span class='period'>.</span><span class='id identifier rubyid_read?'>read?</span>
    <span class='id identifier rubyid_execute_partition_read'>execute_partition_read</span> <span class='id identifier rubyid_partition'>partition</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="partition_query-instance_method">
  
    #<strong>partition_query</strong>(sql, params: nil, types: nil, partition_size_bytes: nil, max_partitions: nil)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Google::Cloud::Spanner::Partition</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a list of <span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Partition</a></span> objects to execute a batch query against
a database.</p>

<p>These partitions can be executed across multiple processes, even
across different machines. The partition size and count can be
configured, although the values given may not necessarily be honored
depending on the query and options in the request.</p>

<p>The query must have a single <a href="https://cloud.google.com/spanner/docs/query-execution-operators#distributed_union">distributed
union</a>
operator at the root of the query plan. Such queries are
root-partitionable. If a query cannot be partitioned at the root,
Cloud Spanner cannot achieve the parallelism and in this case
partition generation will fail.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_sql'>sql</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT u.id, u.active FROM users AS u \
       WHERE u.id &lt; 2000 AND u.active = false</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_partitions'>partitions</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_partition_query'>partition_query</span> <span class='id identifier rubyid_sql'>sql</span>

<span class='id identifier rubyid_partition'>partition</span> <span class='op'>=</span> <span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute_partition'>execute_partition</span> <span class='id identifier rubyid_partition'>partition</span>

<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sql</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The SQL query string. See <a href="https://cloud.google.com/spanner/docs/query-syntax">Query
syntax</a>.</p>

<p>The SQL query string can contain parameter placeholders. A parameter
placeholder consists of &quot;@&quot; followed by the parameter name.
Parameter names consist of any combination of letters, numbers, and
underscores.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>SQL parameters for the query string. The
parameter placeholders, minus the &quot;@&quot;, are the the hash keys, and
the literal values are the hash values. If the query string contains
something like &quot;WHERE id &gt; @msg_id&quot;, then the params must contain
something like <code>:msg_id =&gt; 1</code>.</p>

<p>Ruby types are mapped to Spanner types as follows:</p>

<table><thead>
<tr>
<th>Spanner</th>
<th>Ruby</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><code>BOOL</code></td>
<td><code>true</code>/<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>INT64</code></td>
<td><code>Integer</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT64</code></td>
<td><code>Float</code></td>
<td></td>
</tr>
<tr>
<td><code>STRING</code></td>
<td><code>String</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>Date</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>Time</code>, <code>DateTime</code></td>
<td></td>
</tr>
<tr>
<td><code>BYTES</code></td>
<td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>
<td></td>
</tr>
<tr>
<td><code>ARRAY</code></td>
<td><code>Array</code></td>
<td>Nested arrays are not supported.</td>
</tr>
<tr>
<td><code>STRUCT</code></td>
<td><code>Hash</code>, <span class='object_link'><a href="Data.html" title="Google::Cloud::Spanner::Data (class)">Data</a></span></td>
<td></td>
</tr>
</tbody></table>

<p>See <a href="https://cloud.google.com/spanner/docs/data-definition-language#data_types">Data
types</a>.</p>

<p>See <a href="https://cloud.google.com/spanner/docs/data-types#constructing-a-struct">Data Types - Constructing a
STRUCT</a>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>types</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Types of the SQL parameters in <code>params</code>. It is not
always possible for Cloud Spanner to infer the right SQL type from a
value in <code>params</code>. In these cases, the <code>types</code> hash must be used to
specify the SQL type for these values.</p>

<p>The keys of the hash should be query string parameter placeholders,
minus the &quot;@&quot;. The values of the hash should be Cloud Spanner type
codes from the following list:</p>

<ul>
<li><code>:BOOL</code></li>
<li><code>:BYTES</code></li>
<li><code>:DATE</code></li>
<li><code>:FLOAT64</code></li>
<li><code>:INT64</code></li>
<li><code>:STRING</code></li>
<li><code>:TIMESTAMP</code></li>
<li><code>Array</code> - Lists are specified by providing the type code in an
array. For example, an array of integers are specified as
<code>[:INT64]</code>.</li>
<li><span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span> - Types for STRUCT values (<code>Hash</code>/<span class='object_link'><a href="Data.html" title="Google::Cloud::Spanner::Data (class)">Data</a></span> objects) are
specified using a <span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span> object.</li>
</ul>

<p>Types are optional.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>partition_size_bytes</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The desired data size for each
partition generated. This is only a hint. The actual size of each
partition may be smaller or larger than this size request.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max_partitions</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The desired maximum number of
partitions to return. For example, this may be set to the number of
workers available. This is only a hint and may provide different
results based on the request.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Google::Cloud::Spanner::Partition</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The partitions
created by the query partition.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 191</span>

<span class='kw'>def</span> <span class='id identifier rubyid_partition_query'>partition_query</span> <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='label'>params:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>types:</span> <span class='kw'>nil</span><span class='comma'>,</span>
                    <span class='label'>partition_size_bytes:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>max_partitions:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_ensure_session!'>ensure_session!</span>

  <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span> <span class='op'>=</span> <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_to_input_params_and_types'>to_input_params_and_types</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span>

  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_partition_query'>partition_query</span> \
    <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_tx_selector'>tx_selector</span><span class='comma'>,</span> <span class='label'>params:</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='label'>types:</span> <span class='id identifier rubyid_types'>types</span><span class='comma'>,</span>
                      <span class='label'>partition_size_bytes:</span> <span class='id identifier rubyid_partition_size_bytes'>partition_size_bytes</span><span class='comma'>,</span>
                      <span class='label'>max_partitions:</span> <span class='id identifier rubyid_max_partitions'>max_partitions</span>

  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_grpc'>grpc</span><span class='op'>|</span>
    <span class='comment'># Convert partition protos to execute sql request protos
</span>    <span class='id identifier rubyid_execute_grpc'>execute_grpc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Spanner.html" title="Google::Spanner (module)">Spanner</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Spanner/V1.html" title="Google::Spanner::V1 (module)">V1</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Spanner/V1/ExecuteSqlRequest.html" title="Google::Spanner::V1::ExecuteSqlRequest (class)">ExecuteSqlRequest</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='lbrace'>{</span>
        <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span>
        <span class='label'>sql:</span> <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span>
        <span class='label'>params:</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span>
        <span class='label'>param_types:</span> <span class='id identifier rubyid_types'>types</span><span class='comma'>,</span>
        <span class='label'>transaction:</span> <span class='id identifier rubyid_tx_selector'>tx_selector</span><span class='comma'>,</span>
        <span class='label'>partition_token:</span> <span class='id identifier rubyid_grpc'>grpc</span><span class='period'>.</span><span class='id identifier rubyid_partition_token'>partition_token</span>
      <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
    <span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Partition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from_execute_grpc'>from_execute_grpc</span> <span class='id identifier rubyid_execute_grpc'>execute_grpc</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="partition_read-instance_method">
  
    #<strong>partition_read</strong>(table, columns, keys: nil, index: nil, partition_size_bytes: nil, max_partitions: nil)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Google::Cloud::Spanner::Partition</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a list of <span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Partition</a></span> objects to read zero or more rows from a
database.</p>

<p>These partitions can be executed across multiple processes, even
across different machines. The partition size and count can be
configured, although the values given may not necessarily be honored
depending on the query and options in the request.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_partitions'>partitions</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_partition_read'>partition_read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_partition'>partition</span> <span class='op'>=</span> <span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_execute_partition'>execute_partition</span> <span class='id identifier rubyid_partition'>partition</span>

<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the table in the database to be
read.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>columns</span>
      
      
        <span class='type'>(<tt>Array&lt;String, Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The columns of table to be
returned for each row matching this request.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>Array&lt;Object&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A single, or list of keys or key
ranges to match returned data to. Values should have exactly as many
elements as there are columns in the primary key.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of an index to use instead of the
table&#39;s primary key when interpreting <code>id</code> and sorting result rows.
Optional.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>partition_size_bytes</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The desired data size for each
partition generated. This is only a hint. The actual size of each
partition may be smaller or larger than this size request.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max_partitions</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The desired maximum number of
partitions to return. For example, this may be set to the number of
workers available. This is only a hint and may provide different
results based on the request.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Google::Cloud::Spanner::Partition</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The partitions
created by the read partition.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 263</span>

<span class='kw'>def</span> <span class='id identifier rubyid_partition_read'>partition_read</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span> <span class='label'>keys:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>index:</span> <span class='kw'>nil</span><span class='comma'>,</span>
                   <span class='label'>partition_size_bytes:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>max_partitions:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_ensure_session!'>ensure_session!</span>

  <span class='id identifier rubyid_columns'>columns</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_columns'>columns</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_to_key_set'>to_key_set</span> <span class='id identifier rubyid_keys'>keys</span>

  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_partition_read'>partition_read</span> \
    <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span> <span class='id identifier rubyid_tx_selector'>tx_selector</span><span class='comma'>,</span>
    <span class='label'>keys:</span> <span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span> <span class='label'>index:</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span>
    <span class='label'>partition_size_bytes:</span> <span class='id identifier rubyid_partition_size_bytes'>partition_size_bytes</span><span class='comma'>,</span>
    <span class='label'>max_partitions:</span> <span class='id identifier rubyid_max_partitions'>max_partitions</span>

  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_grpc'>grpc</span><span class='op'>|</span>
    <span class='comment'># Convert partition protos to read request protos
</span>    <span class='id identifier rubyid_read_grpc'>read_grpc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Spanner.html" title="Google::Spanner (module)">Spanner</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Spanner/V1.html" title="Google::Spanner::V1 (module)">V1</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Spanner/V1/ReadRequest.html" title="Google::Spanner::V1::ReadRequest (class)">ReadRequest</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='lbrace'>{</span>
        <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span>
        <span class='label'>table:</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span>
        <span class='label'>columns:</span> <span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span>
        <span class='label'>key_set:</span> <span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span>
        <span class='label'>index:</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span>
        <span class='label'>transaction:</span> <span class='id identifier rubyid_tx_selector'>tx_selector</span><span class='comma'>,</span>
        <span class='label'>partition_token:</span> <span class='id identifier rubyid_grpc'>grpc</span><span class='period'>.</span><span class='id identifier rubyid_partition_token'>partition_token</span>
      <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
    <span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="Partition.html" title="Google::Cloud::Spanner::Partition (class)">Partition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from_read_grpc'>from_read_grpc</span> <span class='id identifier rubyid_read_grpc'>read_grpc</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read-instance_method">
  
    #<strong>read</strong>(table, columns, keys: nil, index: nil, limit: nil)  &#x21d2; <tt><span class='object_link'><a href="Results.html" title="Google::Cloud::Spanner::Results (class)">Google::Cloud::Spanner::Results</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Read rows from a database table, as a simple alternative to
<span class='object_link'><a href="#execute-instance_method" title="Google::Cloud::Spanner::BatchSnapshot#execute (method)">#execute</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_batch_client'>batch_client</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_batch_client'>batch_client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_client'>batch_client</span><span class='period'>.</span><span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_snapshot'>batch_snapshot</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the table in the database to be
read.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>columns</span>
      
      
        <span class='type'>(<tt>Array&lt;String, Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The columns of table to be
returned for each row matching this request.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>Array&lt;Object&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A single, or list of keys or key
ranges to match returned data to. Values should have exactly as many
elements as there are columns in the primary key.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of an index to use instead of the
table&#39;s primary key when interpreting <code>id</code> and sorting result rows.
Optional.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>limit</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>If greater than zero, no more than this number
of rows will be returned. The default is no limit.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Results.html" title="Google::Cloud::Spanner::Results (class)">Google::Cloud::Spanner::Results</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The results of the read
operation.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


557
558
559
560
561
562
563
564
565</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 557</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read'>read</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span> <span class='label'>keys:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>index:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_ensure_session!'>ensure_session!</span>

  <span class='id identifier rubyid_columns'>columns</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_columns'>columns</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_to_key_set'>to_key_set</span> <span class='id identifier rubyid_keys'>keys</span>

  <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span> <span class='label'>keys:</span> <span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span> <span class='label'>index:</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='id identifier rubyid_limit'>limit</span><span class='comma'>,</span>
                               <span class='label'>transaction:</span> <span class='id identifier rubyid_tx_selector'>tx_selector</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="timestamp-instance_method">
  
    #<strong>timestamp</strong>  &#x21d2; <tt>Time</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The read timestamp chosen for batch snapshot.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The chosen timestamp.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 87</span>

<span class='kw'>def</span> <span class='id identifier rubyid_timestamp'>timestamp</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_grpc'>grpc</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_timestamp_to_time'>timestamp_to_time</span> <span class='id identifier rubyid_grpc'>grpc</span><span class='period'>.</span><span class='id identifier rubyid_read_timestamp'>read_timestamp</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="transaction_id-instance_method">
  
    #<strong>transaction_id</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Identifier of the batch snapshot transaction.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The transaction id.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/batch_snapshot.rb', line 79</span>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction_id'>transaction_id</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_grpc'>grpc</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_grpc'>grpc</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
