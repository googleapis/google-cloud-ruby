---
layout: yard_main
title: "Class: Stackdriver::Core::TraceContext - Stackdriver"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "Stackdriver::Core::TraceContext";
  relpath = '../../';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="../../class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span>
     &raquo; 
    <span class="title">TraceContext</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><h1>Class: Stackdriver::Core::TraceContext
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Stackdriver::Core::TraceContext</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/stackdriver/core/trace_context.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>A Stackdriver trace context links the current request into a performance
trace, and communicates tracing options between related requests. This
functionality is used by the Stackdriver diagnostics libraries
(including google-cloud-trace, google-cloud-logging, and other rubygems)
that integrate with the tracing service.</p>

<p>Most applications will not need to use the TraceContext class directly.
The Stackdriver libraries use it internally to store and propagate
context information.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#span_id-instance_method" title="#span_id (instance method)">#<strong>span_id</strong>  &#x21d2; Integer<sup>?</sup> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The span ID, as a 64-bit integer, or <code>nil</code> if no span ID is present in the context.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#trace_id-instance_method" title="#trace_id (instance method)">#<strong>trace_id</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The trace ID, as a hex string.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get-class_method" title="get (class method)">.<strong>get</strong>  &#x21d2; TraceContext<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the current thread&#39;s trace context, or <code>nil</code> if no trace context has been set.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_rack_env-class_method" title="parse_rack_env (class method)">.<strong>parse_rack_env</strong>(env)  &#x21d2; TraceContext </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Obtains a TraceContext from the given Rack environment.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_string-class_method" title="parse_string (class method)">.<strong>parse_string</strong>(str)  &#x21d2; TraceContext<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Attempts to parse the given string as a trace context representation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set-class_method" title="set (class method)">.<strong>set</strong>(trace_context)  &#x21d2; TraceContext<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set the current thread&#39;s trace context, and returns the context.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture_stack%3F-instance_method" title="#capture_stack? (instance method)">#<strong>capture_stack?</strong>  &#x21d2; Boolean<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns <code>true</code> if the context wants to capture stack traces, <code>false</code> if the context does not, or <code>nil</code> if the context does not specify a sampling decision.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#eql%3F-instance_method" title="#eql? (instance method)">#<strong>eql?</strong>(other)  &#x21d2; Boolean </a>
    

    
      (also: #==)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Standard value equality check for this object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hash-instance_method" title="#hash (instance method)">#<strong>hash</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Generate standard hash code for this object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(trace_id: nil, is_new: nil, span_id: nil, sampled: nil, capture_stack: false)  &#x21d2; TraceContext </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create a new TraceContext instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new%3F-instance_method" title="#new? (instance method)">#<strong>new?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns <code>true</code> if this trace includes a newly generated trace_id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sampled%3F-instance_method" title="#sampled? (instance method)">#<strong>sampled?</strong>  &#x21d2; Boolean<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns <code>true</code> if the context wants to sample, <code>false</code> if the context wants explicitly to disable sampling, or <code>nil</code> if the context does not specify.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_string-instance_method" title="#to_string (instance method)">#<strong>to_string</strong>  &#x21d2; String </a>
    

    
      (also: #to_s)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a string representation of this trace context, in the form <code>&lt;traceid&gt;[/&lt;spanid&gt;][;o=&lt;options&gt;]</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with-instance_method" title="#with (instance method)">#<strong>with</strong>(trace_id: UNCHANGED, is_new: UNCHANGED, span_id: UNCHANGED, sampled: UNCHANGED, capture_stack: UNCHANGED)  &#x21d2; TraceContext </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a new TraceContext instance that is identical to this instance except for the given changes.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(trace_id: nil, is_new: nil, span_id: nil, sampled: nil, capture_stack: false)  &#x21d2; <tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create a new TraceContext instance.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stackdriver/core</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_id'>trace_id</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0123456789abcdef0123456789abcdef</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='label'>trace_id:</span> <span class='id identifier rubyid_trace_id'>trace_id</span><span class='comma'>,</span>
                                          <span class='label'>sampled:</span> <span class='kw'>true</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>trace_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The trace ID as a hex string. If nil or
omitted, a new random Trace ID will be generated, and this
TraceContext will be marked as new.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>is_new</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether this trace context should be flagged
as newly created. Optional: if unset, will reflect whether a new
trace_id was generated when this object was created.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>span_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The context parent span ID as a 64-bit int.
If nil or omitted, the context will specify no parent span.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sampled</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether the context has decided to sample
this trace or not, or nil if the context does not specify a
sampling decision.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>capture_stack</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether the the context has decided to
capture stack traces. Ignored if sampled is not true.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 70</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='label'>trace_id:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>is_new:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>span_id:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>sampled:</span> <span class='kw'>nil</span><span class='comma'>,</span>
               <span class='label'>capture_stack:</span> <span class='kw'>false</span>
  <span class='ivar'>@trace_id</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_id'>trace_id</span> <span class='op'>||</span> <span class='id identifier rubyid_new_random_trace_id'>new_random_trace_id</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_is_new'>is_new</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@is_new</span> <span class='op'>=</span> <span class='op'>!</span><span class='id identifier rubyid_trace_id'>trace_id</span>
  <span class='kw'>else</span>
    <span class='ivar'>@is_new</span> <span class='op'>=</span> <span class='id identifier rubyid_is_new'>is_new</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='ivar'>@span_id</span> <span class='op'>=</span> <span class='id identifier rubyid_span_id'>span_id</span> <span class='op'>?</span> <span class='id identifier rubyid_span_id'>span_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='ivar'>@sampled</span> <span class='op'>=</span> <span class='id identifier rubyid_sampled'>sampled</span>
  <span class='kw'>if</span> <span class='ivar'>@sampled</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@capture_stack</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='ivar'>@sampled</span> <span class='op'>=</span> <span class='ivar'>@sampled</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
    <span class='ivar'>@capture_stack</span> <span class='op'>=</span> <span class='id identifier rubyid_capture_stack'>capture_stack</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@sampled</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="span_id-instance_method">
  
    #<strong>span_id</strong>  &#x21d2; <tt>Integer</tt><sup>?</sup>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The span ID, as a 64-bit integer, or <code>nil</code> if no span ID is present
in the context.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_span_id'>span_id</span>
  <span class='ivar'>@span_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="trace_id-instance_method">
  
    #<strong>trace_id</strong>  &#x21d2; <tt>String</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The trace ID, as a hex string.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 93</span>

<span class='kw'>def</span> <span class='id identifier rubyid_trace_id'>trace_id</span>
  <span class='ivar'>@trace_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="get-class_method">
  
    .<strong>get</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the current thread&#39;s trace context, or <code>nil</code> if no trace
context has been set.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stackdriver/core</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Stackdriver::Core::TraceContext#initialize (method)">new</a></span></span>
<span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'><span class='object_link'><a href="#set-class_method" title="Stackdriver::Core::TraceContext.set (method)">set</a></span></span> <span class='id identifier rubyid_ctx'>ctx</span>
<span class='id identifier rubyid_same_ctx'>same_ctx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 324</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='const'>THREAD_KEY</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_rack_env-class_method">
  
    .<strong>parse_rack_env</strong>(env)  &#x21d2; <tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Obtains a TraceContext from the given Rack environment. This should
be used by any service that wants to obtain the TraceContext for a
Rack request. If a new trace context is generated in the process, it
is memoized into the Rack environment so subsequent services will get
the same context.</p>

<p>Specifically, the following steps are attempted in order:</p>

<ol>
<li>Attempts to use any memoized context previously obtained.</li>
<li>Attempts to parse the trace context header.</li>
<li>Creates a new trace context with a random trace ID.</li>
</ol>

<p>Furthermore, if a block is given, it is provided with an opportunity
to modify the trace context. The current trace context and the Rack
environment is passed to the block, and its result is used as the
final trace context. The final context is memoized back into the
Rack environment.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stackdriver/core</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>class</span> <span class='const'>MyMiddleware</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='id identifier rubyid_app'>app</span>
    <span class='ivar'>@app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'>app</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_env'>env</span>
    <span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_rack_env'>parse_rack_env</span> <span class='id identifier rubyid_env'>env</span>
    <span class='id identifier rubyid_do_something_with'>do_something_with</span> <span class='id identifier rubyid_ctx'>ctx</span>
    <span class='ivar'>@app</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_env'>env</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>env</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Rack environment hash</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


283
284
285
286
287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 283</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_rack_env'>parse_rack_env</span> <span class='id identifier rubyid_env'>env</span>
  <span class='id identifier rubyid_trace_context'>trace_context</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='const'>MEMO_RACK_KEY</span><span class='rbracket'>]</span> <span class='op'>||</span>
                  <span class='id identifier rubyid_parse_string'>parse_string</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='const'>HEADER_RACK_KEY</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span> <span class='op'>||</span>
                  <span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_trace_context'>trace_context</span> <span class='op'>=</span> <span class='kw'>yield</span> <span class='id identifier rubyid_trace_context'>trace_context</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='const'>MEMO_RACK_KEY</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_context'>trace_context</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_string-class_method">
  
    .<strong>parse_string</strong>(str)  &#x21d2; <tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Attempts to parse the given string as a trace context representation.
Expects the form <code>&lt;traceid&gt;[/&lt;spanid&gt;][;o=&lt;options&gt;]</code>, which is the
form used in the trace context header. Returns either the parsed
trace context, or <code>nil</code> if the string was malformed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stackdriver/core</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0123456789abcdef0123456789abcdef/12345;o=1</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_string'>parse_string</span> <span class='id identifier rubyid_str'>str</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The string to parse.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 227</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_string'>parse_string</span> <span class='id identifier rubyid_str'>str</span>
  <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>%r|</span><span class='tstring_content'>^(\w{32})(/(\d+))?(;o=(\d+))?</span><span class='regexp_end'>|</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span> <span class='id identifier rubyid_str'>str</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_match'>match</span>
    <span class='id identifier rubyid_trace_id'>trace_id</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_span_id'>span_id</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>:</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>:</span> <span class='kw'>nil</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_sampled'>sampled</span> <span class='op'>=</span> <span class='id identifier rubyid_capture_stack'>capture_stack</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_sampled'>sampled</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>&amp;</span> <span class='int'>1</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_capture_stack'>capture_stack</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>&amp;</span> <span class='int'>2</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_new'>new</span> <span class='label'>trace_id:</span> <span class='id identifier rubyid_trace_id'>trace_id</span><span class='comma'>,</span> <span class='label'>span_id:</span> <span class='id identifier rubyid_span_id'>span_id</span><span class='comma'>,</span> <span class='label'>sampled:</span> <span class='id identifier rubyid_sampled'>sampled</span><span class='comma'>,</span>
        <span class='label'>capture_stack:</span> <span class='id identifier rubyid_capture_stack'>capture_stack</span>
  <span class='kw'>else</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set-class_method">
  
    .<strong>set</strong>(trace_context)  &#x21d2; <tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set the current thread&#39;s trace context, and returns the context.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stackdriver/core</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Stackdriver::Core::TraceContext#initialize (method)">new</a></span></span>
<span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_ctx'>ctx</span>
<span class='id identifier rubyid_same_ctx'>same_ctx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Stackdriver.html" title="Stackdriver (module)">Stackdriver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Core.html" title="Stackdriver::Core (module)">Core</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="#get-class_method" title="Stackdriver::Core::TraceContext.get (method)">get</a></span></span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>trace_context</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The trace context to
set for the current thread. May be <code>nil</code>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The context set.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


306
307
308
309</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 306</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_trace_context'>trace_context</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='const'>THREAD_KEY</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_context'>trace_context</span>
  <span class='id identifier rubyid_trace_context'>trace_context</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="capture_stack?-instance_method">
  
    #<strong>capture_stack?</strong>  &#x21d2; <tt>Boolean</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns <code>true</code> if the context wants to capture stack traces, <code>false</code> if
the context does not, or <code>nil</code> if the context does not specify a
sampling decision.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 121</span>

<span class='kw'>def</span> <span class='id identifier rubyid_capture_stack?'>capture_stack?</span>
  <span class='ivar'>@capture_stack</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="eql?-instance_method">
  
    #<strong>eql?</strong>(other)  &#x21d2; <tt>Boolean</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='==-instance_method'>==</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Standard value equality check for this object.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>other</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>An object to compare with.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eql?'>eql?</span> <span class='id identifier rubyid_other'>other</span>
  <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_trace_id'>trace_id</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_trace_id'>trace_id</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_new?'>new?</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_new?'>new?</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_span_id'>span_id</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_span_id'>span_id</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_sampled?'>sampled?</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_sampled?'>sampled?</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_capture_stack?'>capture_stack?</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_capture_stack?'>capture_stack?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hash-instance_method">
  
    #<strong>hash</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Generate standard hash code for this object.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 155</span>

<span class='kw'>def</span> <span class='id identifier rubyid_hash'>hash</span>
  <span class='ivar'>@hash</span> <span class='op'>||=</span> <span class='ivar'>@trace_id</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span> <span class='op'>^</span> <span class='ivar'>@is_new</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span> <span class='op'>^</span> <span class='ivar'>@span_id</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span> <span class='op'>^</span>
            <span class='ivar'>@sampled</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span> <span class='op'>^</span> <span class='ivar'>@capture_stack</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new?-instance_method">
  
    #<strong>new?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns <code>true</code> if this trace includes a newly generated trace_id.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new?'>new?</span>
  <span class='ivar'>@is_new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sampled?-instance_method">
  
    #<strong>sampled?</strong>  &#x21d2; <tt>Boolean</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns <code>true</code> if the context wants to sample, <code>false</code> if the context
wants explicitly to disable sampling, or <code>nil</code> if the context does
not specify.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sampled?'>sampled?</span>
  <span class='ivar'>@sampled</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_string-instance_method">
  
    #<strong>to_string</strong>  &#x21d2; <tt>String</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='to_s-instance_method'>to_s</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a string representation of this trace context, in the form
<code>&lt;traceid&gt;[/&lt;spanid&gt;][;o=&lt;options&gt;]</code>. This form is suitable for
setting the trace context header.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200
201
202
203
204
205
206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 198</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_string'>to_string</span>
  <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_id'>trace_id</span>
  <span class='id identifier rubyid_str'>str</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_span_id'>span_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_span_id'>span_id</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_sampled?'>sampled?</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>|=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_sampled?'>sampled?</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>|=</span> <span class='int'>2</span> <span class='kw'>if</span> <span class='id identifier rubyid_capture_stack?'>capture_stack?</span>
    <span class='id identifier rubyid_str'>str</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>;o=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_str'>str</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with-instance_method">
  
    #<strong>with</strong>(trace_id: UNCHANGED, is_new: UNCHANGED, span_id: UNCHANGED, sampled: UNCHANGED, capture_stack: UNCHANGED)  &#x21d2; <tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new TraceContext instance that is identical to this instance
except for the given changes. All parameters are optional. See
<span class='object_link'><a href="#initialize-instance_method" title="Stackdriver::Core::TraceContext#initialize (method)">#initialize</a></span> for more details on each parameter.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>require &quot;stackdriver/core&quot;

trace_id = &quot;0123456789abcdef0123456789abcdef&quot;
orig_ctx = Stackdriver::Core::TraceContext.new trace_id: trace_id,

sampled_ctx = orig_ctx.with sampled: true</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>trace_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>New trace ID.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>is_new</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>New setting for newness indicator.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>span_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>New parent span ID.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sampled</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>New sampling decision.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>capture_stack</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>New stack capture decision.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


180
181
182
183
184
185
186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stackdriver/core/trace_context.rb', line 180</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with'>with</span> <span class='label'>trace_id:</span> <span class='const'>UNCHANGED</span><span class='comma'>,</span> <span class='label'>is_new:</span> <span class='const'>UNCHANGED</span><span class='comma'>,</span> <span class='label'>span_id:</span> <span class='const'>UNCHANGED</span><span class='comma'>,</span>
         <span class='label'>sampled:</span> <span class='const'>UNCHANGED</span><span class='comma'>,</span> <span class='label'>capture_stack:</span> <span class='const'>UNCHANGED</span>
  <span class='id identifier rubyid_trace_id'>trace_id</span> <span class='op'>=</span> <span class='ivar'>@trace_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_trace_id'>trace_id</span> <span class='op'>==</span> <span class='const'>UNCHANGED</span>
  <span class='id identifier rubyid_is_new'>is_new</span> <span class='op'>=</span> <span class='ivar'>@is_new</span> <span class='kw'>if</span> <span class='id identifier rubyid_is_new'>is_new</span> <span class='op'>==</span> <span class='const'>UNCHANGED</span>
  <span class='id identifier rubyid_span_id'>span_id</span> <span class='op'>=</span> <span class='ivar'>@span_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_span_id'>span_id</span> <span class='op'>==</span> <span class='const'>UNCHANGED</span>
  <span class='id identifier rubyid_sampled'>sampled</span> <span class='op'>=</span> <span class='ivar'>@sampled</span> <span class='kw'>if</span> <span class='id identifier rubyid_sampled'>sampled</span> <span class='op'>==</span> <span class='const'>UNCHANGED</span>
  <span class='id identifier rubyid_capture_stack'>capture_stack</span> <span class='op'>=</span> <span class='ivar'>@capture_stack</span> <span class='kw'>if</span> <span class='id identifier rubyid_capture_stack'>capture_stack</span> <span class='op'>==</span> <span class='const'>UNCHANGED</span>
  <span class='const'><span class='object_link'><a href="" title="Stackdriver::Core::TraceContext (class)">TraceContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Stackdriver::Core::TraceContext#initialize (method)">new</a></span></span> <span class='label'>trace_id:</span> <span class='id identifier rubyid_trace_id'>trace_id</span><span class='comma'>,</span> <span class='label'>is_new:</span> <span class='id identifier rubyid_is_new'>is_new</span><span class='comma'>,</span> <span class='label'>span_id:</span> <span class='id identifier rubyid_span_id'>span_id</span><span class='comma'>,</span>
                   <span class='label'>sampled:</span> <span class='id identifier rubyid_sampled'>sampled</span><span class='comma'>,</span> <span class='label'>capture_stack:</span> <span class='id identifier rubyid_capture_stack'>capture_stack</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
